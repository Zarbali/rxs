# Настройка отзывов, если у вас уже есть Discord-сервер

У вас есть свой Discord-сервер (например, RXS | Operation: Whisper of Sand). Ниже — что нужно сделать в этом случае.

---

## Discord-сервер и Discord-приложение — это разное

| | Discord-сервер | Discord-приложение (Application) |
|---|----------------|-----------------------------------|
| **Что это** | Сервер, где общаются люди | Программа для входа на сайт |
| **Где создаётся** | В Discord (кнопка «+») | На [discord.com/developers](https://discord.com/developers/applications) |
| **Для чего** | Общение, каналы, роли | OAuth-вход («Войти через Discord») |
| **Связь** | Не обязательна для входа | Нужна для авторизации на сайте |

Для кнопки «Войти через Discord» нужна **именно Discord Application**, а не сервер. Сервер уже может существовать — его наличие не мешает настройке.

---

## Два варианта

### Вариант A: Входить может любой пользователь Discord

Любой, у кого есть Discord, может войти на сайт и оставить отзыв. Сервер и сайт не связаны.

### Вариант B: Входить могут только участники вашего сервера

Только те, кто состоит в вашем Discord-сервере, могут оставлять отзывы. Это сложнее в настройке.

---

## Вариант A (рекомендуется)

### Шаг 1: Создать приложение

1. Откройте **https://discord.com/developers/applications**
2. Войдите в аккаунт владельца/модератора Discord-сервера
3. Нажмите **«New Application»**
4. Имя, например: **RXS Site** (не обязательно совпадает с названием сервера)
5. **Create**

### Шаг 2: Скопировать Client ID и Client Secret

1. В левом меню: **OAuth2** → **General**
2. Скопируйте **Client ID**
3. Нажмите **«Reset Secret»**, скопируйте **Client Secret** и сохраните

### Шаг 3: Redirect URL в Discord

1. **OAuth2** → **Redirects** → **Add Redirect**
2. Вставьте (сначала создайте проект Supabase — см. инструкцию выше):
   ```
   https://ВАШ_PROJECT_REF.supabase.co/auth/v1/callback
   ```
3. **Save Changes**

Далее — настройка Supabase и `config.js` по основной инструкции (**ИНСТРУКЦИЯ_НАСТРОЙКИ.md**).

---

## Вариант B: Только участники вашего Discord-сервера

Идея: при входе запрашивать `guilds` (список серверов пользователя) и проверять, есть ли среди них ваш сервер.

### Шаг 1: Привязать бота к серверу

1. Создайте приложение на [discord.com/developers](https://discord.com/developers/applications)
2. В меню: **Bot** → **Add Bot**
3. **OAuth2** → **URL Generator**
4. В **SCOPES** отметьте: `bot`
5. В **BOT PERMISSIONS** — минимум `Read Messages/View Channels`
6. Скопируйте сгенерированный URL и откройте его в браузере
7. Выберите свой Discord-сервер и авторизуйте бота

### Шаг 2: В Supabase — настроить Discord OAuth

1. Discord Application → **OAuth2** → **General**
2. Скопируйте **Client ID** и **Client Secret**
3. В **OAuth2** → **Redirects** добавьте:
   ```
   https://ВАШ_PROJECT_REF.supabase.co/auth/v1/callback
   ```
4. Supabase → **Authentication** → **Providers** → **Discord** → вставить Client ID и Secret

### Шаг 3: Изменить скрипт — проверять участника сервера

В Supabase при Discord OAuth по умолчанию не запрашивается список серверов. Чтобы ограничить вход участниками сервера, нужно:

1. В Discord Developer Portal → **OAuth2** → **URL Generator**
   - **SCOPES:** `identify`, `guilds`
   - Это для ручной генерации ссылки, а Supabase использует свои ссылки

2. Supabase не поддерживает произвольные Discord-скопы. Поэтому обычно делают так:
   - либо создают **Discord Bot** и API-эндпоинт на сервере, который проверяет участника;
   - либо используют серверные функции Supabase (Edge Functions) для проверки.

Это уже более сложная схема с backend-логикой.

### Вариант B — упрощённый (без бэкенда)

Можно оставить обычный Discord OAuth (Вариант A) и в форме отзыва добавить поле «ID Discord-сервера» или «Ссылка-приглашение». В описании написать: «Отзывы могут оставлять только участники нашего Discord». Проверку всё равно придётся делать вручную.

---

## Рекомендация

Для большинства случаев достаточно **Варианта A**:

1. Создать Discord Application
2. Настроить Supabase
3. Пользователи входят любым Discord-аккаунтом и пишут отзывы

Связь с вашим Discord-сервером не обязательна. В описании можно написать: «Войдите через Discord и оставьте отзыв о нашем сервере».

---

## Краткая последовательность (Вариант A)

1. [discord.com/developers](https://discord.com/developers/applications) → **New Application**
2. **OAuth2** → скопировать Client ID и Client Secret
3. **OAuth2** → **Redirects** → добавить `https://XXX.supabase.co/auth/v1/callback`
4. [supabase.com](https://supabase.com) → создать проект, настроить Discord
5. В `config.js` указать `url` и `anonKey`
6. Создать таблицу `reviews` в Supabase

Полная пошаговая инструкция — в **ИНСТРУКЦИЯ_НАСТРОЙКИ.md**.
