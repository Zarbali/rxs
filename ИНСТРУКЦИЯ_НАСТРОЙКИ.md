# Полная инструкция по настройке отзывов

Пошаговое руководство: что создать, где настроить и как проверить, что всё работает.

---

## Что вам понадобится

- Аккаунт Discord
- Аккаунт GitHub (если сайт на GitHub Pages)
- 15–20 минут времени

---

## Часть 1: Discord Developer Portal

### Шаг 1.1 — Создать приложение

1. Откройте **https://discord.com/developers/applications**
2. Войдите в Discord, если ещё не вошли
3. Нажмите **«New Application»** (синяя кнопка справа)
4. Введите название, например: **RXS Site** или **RXS Reviews**
5. Нажмите **«Create»**

### Шаг 1.2 — Найти Client ID и Client Secret

1. В левом меню выберите **«OAuth2»** → **«General»**
2. Скопируйте **Client ID** (длинная строка из цифр) и сохраните
3. В том же разделе найдите **Client Secret**
4. Нажмите **«Reset Secret»** (если видите «Copy» — скопируйте)
5. Скопируйте и сохраните **Client Secret** (больше не покажется!)

### Шаг 1.3 — Добавить Redirect URL

1. В левом меню: **«OAuth2»** → **«Redirects»**
2. Нажмите **«Add Redirect»**
3. Вставьте URL (его получите после создания Supabase):

   ```
   https://ВАШ_Project_Reference.supabase.co/auth/v1/callback
   ```

4. **Пока не знаете Project Reference?** Перейдите к Шагу 2, создайте Supabase-проект, скопируйте URL вида `https://xxxxx.supabase.co` — часть `xxxxx` и есть Project Reference
5. Пример: `https://abcdefghijk.supabase.co/auth/v1/callback`
6. Нажмите **«Save Changes»**

---

## Часть 2: Supabase

### Шаг 2.1 — Регистрация и проект

1. Откройте **https://supabase.com**
2. Нажмите **«Start your project»** и войдите через GitHub (или email)
3. Нажмите **«New Project»**
4. Заполните:
   - **Name:** например `rxs-reviews`
   - **Database Password:** придумайте и сохраните (для админки БД)
   - **Region:** ближайший к вашим посетителям
5. Нажмите **«Create new project»** и дождитесь создания (1–2 мин)

### Шаг 2.2 — Скопировать URL и anon key

1. В левом меню: **Settings** (иконка шестерёнки внизу)
2. Перейдите в **«API»**
3. Скопируйте:
   - **Project URL** — например `https://abcdefghijk.supabase.co`
   - **Project API keys** → **anon** **public** — длинный ключ

### Шаг 2.3 — Включить Discord провайдер

1. В левом меню: **«Authentication»** → **«Providers»**
2. Найдите **Discord** и нажмите для раскрытия
3. Включите переключатель **«Enable Sign in with Discord»**
4. Вставьте **Client ID** из Discord
5. Вставьте **Client Secret** из Discord
6. Нажмите **«Save»**

### Шаг 2.4 — Настроить URL сайта

1. **Authentication** → **«URL Configuration»**
2. **Site URL** — основной адрес вашего сайта:
   - GitHub Pages: `https://ВАШ_USERNAME.github.io/ВАШ_РЕПОЗИТОРИЙ/`
   - Пример: `https://john.github.io/rxs/`
3. **Redirect URLs** — список разрешённых адресов после входа. Добавьте:
   - `https://ВАШ_USERNAME.github.io/ВАШ_РЕПОЗИТОРИЙ/`
   - `https://ВАШ_USERNAME.github.io/ВАШ_РЕПОЗИТОРИЙ/index.html`
   - Для локальной проверки: `http://localhost:5500/`
4. Нажмите **«Save»**

### Шаг 2.5 — Вернуться в Discord и добавить Redirect

Если ещё не сделали в Шаге 1.3:

1. Откройте **discord.com/developers** → ваше приложение
2. **OAuth2** → **Redirects** → **Add Redirect**
3. Вставьте: `https://ВАШ_Project_Reference.supabase.co/auth/v1/callback`
   - Project Reference берётся из Project URL Supabase (часть перед `.supabase.co`)
4. **Save Changes**

---

## Часть 3: Таблица отзывов в Supabase

### Шаг 3.1 — Создать таблицу

1. В Supabase: **«SQL Editor»** в левом меню
2. Нажмите **«New query»**
3. Вставьте этот код:

```sql
create table public.reviews (
  id uuid default gen_random_uuid() primary key,
  user_id uuid not null,
  user_name text,
  user_avatar text,
  text text not null check (char_length(text) >= 10),
  created_at timestamptz default now()
);

alter table public.reviews enable row level security;

create policy "Authenticated users can insert"
  on public.reviews for insert
  to authenticated
  with check (true);

create policy "Anyone can read"
  on public.reviews for select
  to anon
  using (true);
```

4. Нажмите **«Run»** (или Ctrl+Enter)
5. Должно появиться сообщение об успешном выполнении

---

## Часть 4: Файл config.js на сайте

### Шаг 4.1 — Заполнить данные

1. Откройте файл **config.js** в корне проекта
2. Замените значения на свои:

```javascript
const SUPABASE_CONFIG = {
    url: 'https://ВАШ_Project_Reference.supabase.co',
    anonKey: 'ВАШ_ANON_KEY'
};
```

3. **url** — Project URL из Supabase (без слэша в конце)
4. **anonKey** — ключ **anon public** из Supabase
5. Сохраните файл

**Пример:**
```javascript
const SUPABASE_CONFIG = {
    url: 'https://abcdefghijk.supabase.co',
    anonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
};
```

---

## Часть 5: Проверка

### Локально (если есть Live Server / локальный сервер)

1. Запустите сайт (например, через расширение Live Server в VS Code)
2. Убедитесь, что в Supabase **Redirect URLs** добавлен `http://localhost:5500/`
3. Нажмите **«Войти»** в меню
4. Выберите **«Войти через Discord»**
5. Должно открыться окно Discord для авторизации
6. После входа — форма отзыва и ваш аватар в меню
7. Напишите тестовый отзыв (минимум 10 символов)
8. Отзыв должен появиться в списке

### На GitHub Pages

1. Закоммитьте и запушьте изменения (включая config.js с вашими данными)
2. Подождите деплой (обычно 1–2 минуты)
3. Откройте ваш сайт
4. Повторите шаги из «Локально» (п. 3–8)

---

## Частая ошибка: «Invalid redirect URL»

**Причина:** URL возврата после входа не совпадает с настройками.

**Что сделать:**
1. Supabase → **Authentication** → **URL Configuration**
2. В **Redirect URLs** добавьте точный URL страницы, на которую возвращается пользователь
3. Учитывайте слэш в конце: `https://site.com/` и `https://site.com` — это разные адреса
4. Добавьте оба варианта при необходимости

---

## Частая ошибка: «Failed to fetch» или пустая страница отзывов

**Причина:** Неверный config.js или ошибка CORS.

**Что сделать:**
1. Проверьте правильность **url** и **anonKey** в config.js
2. Откройте консоль браузера (F12) и посмотрите текст ошибки
3. Убедитесь, что таблица `reviews` создана и в ней есть политики RLS

---

## Сводка: что создано и настроено

| Сервис | Что создано |
|--------|-------------|
| Discord | Приложение, Client ID, Client Secret, Redirect URL |
| Supabase | Проект, Discord провайдер, URL конфигурация, таблица `reviews` |
| Сайт | config.js с url и anonKey |

---

## Полезные ссылки

- [Discord Developer Portal](https://discord.com/developers/applications)
- [Supabase Dashboard](https://supabase.com/dashboard)
- [Документация Supabase: Discord OAuth](https://supabase.com/docs/guides/auth/social-login/auth-discord)
